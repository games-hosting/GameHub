<script>
  function launchRandom() {
    const links = [
      "backrooms.html",
      "baconmaydie.html",
      "balatro.html",
      "buckshot.html",
      "plinko.html",
      "flappy.html",
      "flying-gorilla.html",
      "gta-vice-city.html",
      "minecraft.html",
      "pvz.html",
      "sm64.html",
      "notmyneighbor.html",
      "ultrakill.html",
      "undertale.html",
      "worldshardest.html",
      "snake.html"
    ];
    const randomIndex = Math.floor(Math.random() * links.length);
    window.open(links[randomIndex], '_blank');
  }

  // Search bar
  const searchInput = document.getElementById('searchInput');
  const cards = document.querySelectorAll('.game-card');
  const noResults = document.getElementById('noResults');
  searchInput.addEventListener('input', () => {
    const query = searchInput.value.toLowerCase().trim();
    let visible = 0;
    cards.forEach(card => {
      const title = card.querySelector('h3').textContent.toLowerCase();
      const desc = card.querySelector('p').textContent.toLowerCase();
      const match = title.includes(query) || desc.includes(query);
      card.classList.toggle('hidden', !match && query !== '');
      if (match || query === '') visible++;
    });
    noResults.style.display = (visible === 0 && query !== '') ? 'block' : 'none';
  });

  // Floating dots
  const dotsContainer = document.createElement('div');
  dotsContainer.id = 'floating-dots';
  dotsContainer.style.cssText = 'position:fixed;inset:0;pointer-events:none;z-index:-1;overflow:hidden;';
  document.body.appendChild(dotsContainer);
  for (let i = 0; i < 80; i++) {
    const dot = document.createElement('div');
    dot.className = 'dot';
    const size = Math.random() * 3 + 1;
    dot.style.width = dot.style.height = size + 'px';
    dot.style.left = Math.random() * 100 + 'vw';
    dot.style.top = Math.random() * 100 + 'vh';
    dot.style.background = 'rgba(0, 255, 255, 0.5)';
    dot.style.boxShadow = '0 0 8px rgba(0, 255, 255, 0.6)';
    dot.style.animation = `floatUp ${Math.random() * 80 + 80}s linear infinite`;
    dot.style.animationDelay = Math.random() * 20 + 's';
    dot.style.opacity = Math.random() * 0.4 + 0.1;
    dotsContainer.appendChild(dot);
  }
  if (!document.querySelector('style#dotsAnim')) {
    const anim = document.createElement('style');
    anim.id = 'dotsAnim';
    anim.textContent = `
      @keyframes floatUp {
        0% { transform: translateY(100vh) scale(0.2); opacity: 0; }
        10% { opacity: 0.8; }
        90% { opacity: 0.8; }
        100% { transform: translateY(-20vh) scale(0.8); opacity: 0; }
      }
    `;
    document.head.appendChild(anim);
  }

  // Settings modal
  const settingsBtn = document.getElementById('settings-btn');
  const modal = document.getElementById('settings-modal');
  settingsBtn.onclick = () => modal.style.display = 'flex';
  modal.onclick = e => { if (e.target === modal) modal.style.display = 'none'; };

  // Load & apply saved settings
  let savedSettings = JSON.parse(localStorage.getItem('hubSettings')) || {
    colorScheme: 'default',
    accentColor: '#00ffff',
    brightness: '1.0',
    glow: '1.0'
  };
  applySettings(savedSettings);
  window.addEventListener('storage', e => {
    if (e.key === 'hubSettings') {
      savedSettings = JSON.parse(e.newValue);
      applySettings(savedSettings);
    }
  });
  function applySettings(s) {
    document.body.classList.remove('theme-rgb', 'theme-neon', 'theme-mono', 'theme-purple', 'theme-cyan', 'theme-red', 'theme-green');
    if (s.colorScheme !== 'default') document.body.classList.add('theme-' + s.colorScheme);
    document.body.style.setProperty('--accent-color', s.accentColor || '#00ffff');
    document.body.style.filter = `brightness(${s.brightness || 1.0})`;
    document.querySelectorAll('h1, .random-btn, a').forEach(el => {
      el.style.filter = `drop-shadow(0 0 ${20 * (s.glow || 1.0)}px var(--accent-color))`;
    });
  }
  function saveSettings() {
    const s = {
      colorScheme: document.getElementById('colorScheme').value,
      accentColor: document.getElementById('accentColor').value,
      brightness: document.getElementById('brightness').value,
      glow: document.getElementById('glow').value
    };
    localStorage.setItem('hubSettings', JSON.stringify(s));
    applySettings(s);
    modal.style.display = 'none';
  }

  // Easter egg sequence (fixed)
  let tripleFooter = false;
  let secretE = false;
  let typedInModal = '';

  // Triple-click footer
  document.querySelector('footer').addEventListener('click', e => {
    if (e.detail === 3) {
      tripleFooter = true;
      typedInModal = '';
      secretE = false;
      console.log('Triple footer — step 1 active');
    }
  });

  // Modal keydown for single "e"
  if (modal) {
    modal.addEventListener('keydown', e => {
      if (tripleFooter && !secretE) {
        if (e.key.toLowerCase() === 'e' && typedInModal.length === 0) {
          typedInModal = 'e';
          secretE = true;
          console.log('Single "e" detected — step 2 done');
        } else {
          typedInModal = ''; // reset on any other key
        }
      }
    });
  }

  // Random button logic
  const randomBtn = document.querySelector('.random-btn');
  if (randomBtn) {
    randomBtn.addEventListener('click', e => {
      if (tripleFooter && secretE) {
        e.preventDefault();
        window.location.href = 'vault.html';
        tripleFooter = false;
        secretE = false;
        typedInModal = '';
        console.log('Easter egg triggered — vault');
      } else {
        // Normal random if flags not set
        launchRandom();
      }
    });
  }

  // Reset on modal close or unload
  if (modal) {
    modal.addEventListener('click', e => {
      if (e.target === modal) {
        tripleFooter = false;
        secretE = false;
        typedInModal = '';
      }
    });
  }
  window.addEventListener('beforeunload', () => {
    tripleFooter = false;
    secretE = false;
    typedInModal = '';
  });
</script>
